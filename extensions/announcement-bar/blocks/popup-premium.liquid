{% comment %}
  Popup Premium — App BLOCK
  - image_url + width/height on <img>
{% endcomment %}

<style>
  .popup-premium-overlay {
    display:none; position:fixed; inset:0; background:rgba(0,0,0,.5);
    justify-content:center; align-items:center; z-index:9999;
  }
  .popup-premium-overlay.visible { display:flex !important; }

  .popup-premium-content {
    padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;
    background-color: {{ block.settings.bg_color }}; color: {{ block.settings.text_color }};
    box-shadow: 0 10px 30px rgba(0,0,0,.2); position: relative; animation: fadeIn .4s ease;
    {% if block.settings.background_image != blank %}
      background-image: url("{{ block.settings.background_image | image_url: width: 1600 }}");
      background-size: cover; background-position: center;
    {% endif %}
  }
  .popup-premium-content.light { animation: glowEffect 2s ease-in-out infinite alternate; }
  .popup-premium-content.light-glow {
    {% if block.settings.background_image == blank %}
      background: radial-gradient(circle, {{ block.settings.bg_color }} 0%, transparent 100%);
    {% endif %}
    box-shadow: 0 0 20px {{ block.settings.bg_color }};
    animation: glowEffectStrong 1.6s ease-in-out infinite alternate;
  }
  @keyframes glowEffect { from { box-shadow:0 0 10px {{ block.settings.bg_color }}; } to { box-shadow:0 0 30px {{ block.settings.bg_color }}; } }
  @keyframes glowEffectStrong { from { box-shadow:0 0 20px {{ block.settings.bg_color }}; } to { box-shadow:0 0 45px {{ block.settings.bg_color }}; } }

  .popup-close { position:absolute; top:10px; right:15px; background:transparent; border:0; font-size: {{ block.settings.close_icon_size }}px; color: {{ block.settings.text_color }}; cursor:pointer; }

  .popup-button-container { display:flex; justify-content: {{ block.settings.button_position }}; align-items:center; margin-top: 15px; gap:8px; }
  .popup-button {
    display:inline-flex; align-items:center; gap:8px;
    background: {{ block.settings.button_color }}; color: {{ block.settings.button_text_color }};
    padding: {{ block.settings.button_padding_vertical }}px {{ block.settings.button_padding_horizontal }}px;
    border-radius: {{ block.settings.button_border_radius }}px;
    border: {{ block.settings.button_border_size }}px solid {{ block.settings.button_border_color }};
    font-size: {{ block.settings.button_font_size }}px; font-weight:bold; text-decoration:none;
  }

  @keyframes fadeIn { from { opacity:0; transform:scale(.9);} to { opacity:1; transform:scale(1);} }
</style>

<div id="popup-{{ block.id }}" class="popup-premium-overlay" role="dialog" aria-modal="true" aria-label="Promotion popup">
  <div class="popup-premium-content{% if block.settings.style == 'light' %} light{% elsif block.settings.style == 'light-glow' %} light-glow{% endif %}">
    <button class="popup-close" aria-label="Close">×</button>

    <h2 style="font-size: {{ block.settings.title_font_size }}px; font-weight: {{ block.settings.title_font_weight }}; color: {{ block.settings.title_color }}; text-align: {{ block.settings.title_alignment }};">
      {{ block.settings.title }}
    </h2>

    <p style="font-size: {{ block.settings.message_font_size }}px; text-align: {{ block.settings.message_alignment }}; font-weight: {{ block.settings.message_font_weight }};">
      {{ block.settings.message }}
    </p>

    {% if block.settings.button_text != blank %}
      <div class="popup-button-container">
        {% if block.settings.button_icon != blank %}
          {% assign iw = 24 %}{% assign ih = 24 %}
          <img
            src="{{ block.settings.button_icon | image_url: width: iw, height: ih, crop: 'center' }}"
            width="{{ iw }}" height="{{ ih }}" alt="Button icon">
        {% endif %}
        <a href="{{ block.settings.button_link }}" class="popup-button">{{ block.settings.button_text }}</a>
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const popup   = document.getElementById("popup-{{ block.id }}");
    const closeBtn= popup.querySelector('.popup-close');
    const delayMs = ({{ block.settings.delay | default: 4 }}) * 1000;

    if (popup.parentNode !== document.body) document.body.appendChild(popup);

    popup.classList.remove('visible');
    if (Shopify.designMode) {
      popup.classList.add('visible');
    } else {
      setTimeout(() => popup.classList.add('visible'), delayMs);
    }

    if (closeBtn) closeBtn.addEventListener('click', () => popup.classList.remove('visible'));
  });
</script>

{% schema %}
{
  "name": "Premium Popup",
  "target": "section",
  "settings": [
    { "type": "select", "id": "style", "label": "Style", "default": "standard", "options": [
      { "value": "standard",   "label": "Standard" },
      { "value": "light",      "label": "Glow (soft)" },
      { "value": "light-glow", "label": "Glow (pro)" }
    ]},

    { "type": "text", "id": "title", "label": "Title", "default": "Welcome!" },
    { "type": "select", "id": "title_alignment", "label": "Title align", "default": "center", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},
    { "type": "color", "id": "title_color", "label": "Title color", "default": "#000000" },

    { "type": "textarea", "id": "message", "label": "Message", "default": "Enjoy 10% off with code WELCOME10" },
    { "type": "select", "id": "message_font_weight", "label": "Message weight", "default": "bold", "options": [
      { "value": "normal", "label": "Normal" }, { "value": "bold", "label": "Bold" }
    ]},
    { "type": "select", "id": "message_alignment", "label": "Message align", "default": "center", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ]},

    { "type": "color", "id": "text_color", "label": "Text color", "default": "#000000" },
    { "type": "range", "id": "title_font_size", "label": "Title size (px)", "min": 14, "max": 48, "step": 1, "default": 24 },
    { "type": "select", "id": "title_font_weight", "label": "Title weight", "default": "bold", "options": [
      { "value": "normal", "label": "Normal" }, { "value": "bold", "label": "Bold" }
    ]},
    { "type": "range", "id": "message_font_size", "label": "Message size (px)", "min": 12, "max": 36, "step": 1, "default": 16 },

    { "type": "image_picker", "id": "background_image", "label": "Background image" },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#F9E010" },

    { "type": "range", "id": "close_icon_size", "label": "Close icon size (px)", "min": 12, "max": 40, "step": 1, "default": 22 },
    { "type": "range", "id": "delay", "label": "Show delay (sec)", "min": 0, "max": 30, "step": 1, "default": 4 },

    { "type": "text", "id": "button_text", "label": "Button text", "default": "Get it" },
    { "type": "url",  "id": "button_link", "label": "Button link" },
    { "type": "select", "id": "button_position", "label": "Button position", "default": "center", "options": [
      { "value": "flex-start", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "flex-end", "label": "Right" }
    ]},
    { "type": "range", "id": "button_padding_vertical", "label": "Button padding vertical (px)", "min": 0, "max": 30, "step": 1, "default": 10 },
    { "type": "range", "id": "button_padding_horizontal", "label": "Button padding horizontal (px)", "min": 0, "max": 50, "step": 1, "default": 20 },
    { "type": "range", "id": "button_font_size", "label": "Button font size (px)", "min": 12, "max": 32, "step": 1, "default": 16 },
    { "type": "color", "id": "button_color", "label": "Button background", "default": "#000000" },
    { "type": "color", "id": "button_text_color", "label": "Button text color", "default": "#ffffff" }
  ]
}
{% endschema %}
