<style>
  .countdown-container {
    width: 100vw !important; position: relative; left: 50%; margin-left: -50vw;
    padding: 18px 10px; text-align: center; color: {{ block.settings.text_color }};
    font-size: {{ block.settings.font_size }}px; font-weight: bold;
    display: flex; flex-wrap: nowrap; align-items: center; justify-content: space-between;

    {% if block.settings.background_image != blank %}
      background-image: url({{ block.settings.background_image | image_url: width: 2048 }});
      background-size: cover; background-position: center;
    {% else %}
      background-color: {{ block.settings.bg_color }};
    {% endif %}
  }

  .countdown-label { margin-right: 18px; font-size: calc({{ block.settings.font_size }}px + 2px); white-space: nowrap; }
  .countdown-timer { display: flex; flex-wrap: nowrap; justify-content: center; gap: 12px; flex: 1; min-width: 0; }

  .countdown-block {
    padding: 10px 12px;
    min-width: {{ block.settings.block_width }};
    min-height: {{ block.settings.block_height }};
    display: flex; align-items: center; justify-content: center;
    color: {{ block.settings.text_color }};

    {% if block.settings.block_background_image != blank %}
      background-image: url({{ block.settings.block_background_image | image_url: width: 512 }});
      background-size: cover; background-position: center;
    {% else %}
      background-color: {{ block.settings.timer_bg }};
    {% endif %}

    border: {{ block.settings.border_size }} solid {{ block.settings.border_color }};
    font-size: {{ block.settings.font_size }}px;
  }

  .countdown-rectangle .countdown-block { border-radius: 8px; }
  .countdown-circle .countdown-block { border-radius: 50%; }
  .glow-effect .countdown-block { animation: glow 1.5s infinite alternate; }
  @keyframes glow { from { box-shadow: 0 0 8px {{ block.settings.border_color }}; } to { box-shadow: 0 0 20px {{ block.settings.border_color }}; } }

  .countdown-button-container { margin-left: 18px; flex-shrink: 0; }
  .countdown-button {
    background: {{ block.settings.button_color }}; color: {{ block.settings.button_text_color }};
    padding: 7px 14px; border-radius: 4px; font-weight: bold; text-decoration: none; white-space: nowrap;
  }

  @media (max-width: 600px) {
    .countdown-container { padding: 8px 6px; flex-wrap: wrap; justify-content: center; gap: 8px; }
    .countdown-label { font-size: calc({{ block.settings.font_size }}px * 0.65); margin-right: 0; width: 100%; text-align: center; }
    .countdown-timer { gap: 8px; flex-wrap: nowrap; justify-content: center; width: 100%; margin-bottom: 8px; }
    .countdown-block {
      padding: 6px 8px;
      min-width: calc({{ block.settings.block_width | replace: 'px', '' }} / 2.5) + "px";
      min-height: calc({{ block.settings.block_height | replace: 'px', '' }} / 2.5) + "px";
      font-size: calc({{ block.settings.font_size }}px * 0.65);
    }
    .countdown-button-container { margin-left: 0; width: 100%; text-align: center; }
    .countdown-button { padding: 6px 12px; font-size: calc({{ block.settings.font_size }}px * 0.65); display: inline-block; width: auto; white-space: nowrap; }
  }
</style>

<div class="shopify-section countdown-container countdown-{{ block.settings.style }}{% if block.settings.glow_effect %} glow-effect{% endif %}">
  <div class="countdown-label">{{ block.settings.text }}</div>
  <div id="countdown-{{ block.id }}" class="countdown-timer"></div>

  {% if block.settings.button_text != blank %}
    <div class="countdown-button-container">
      <a href="{{ block.settings.button_link }}" class="countdown-button">{{ block.settings.button_text }}</a>
    </div>
  {% endif %}
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const endTime = new Date("{{ block.settings.end_date }}").getTime();
    const display = document.getElementById("countdown-{{ block.id }}");

    function pad(n) { return String(n).padStart(2, '0'); }
    function updateCountdown() {
      const now = Date.now();
      let diff = endTime - now;
      if (diff <= 0) { clearInterval(timer); diff = 0; }

      const d = Math.floor(diff / (1000 * 60 * 60 * 24));
      const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const m = Math.floor((diff / (1000 * 60)) % 60);
      const s = Math.floor((diff / 1000) % 60);
      const parts = [];
      if ({{ block.settings.show_days }})    { parts.push(`<div class="countdown-block">${pad(d)}${'{{ block.settings.label_days }}'}</div>`); }
      if ({{ block.settings.show_hours }})   { parts.push(`<div class="countdown-block">${pad(h)}${'{{ block.settings.label_hours }}'}</div>`); }
      if ({{ block.settings.show_minutes }}) { parts.push(`<div class="countdown-block">${pad(m)}${'{{ block.settings.label_minutes }}'}</div>`); }
      if ({{ block.settings.show_seconds }}) { parts.push(`<div class="countdown-block">${pad(s)}${'{{ block.settings.label_seconds }}'}</div>`); }
      display.innerHTML = parts.join("");
    }
    const timer = setInterval(updateCountdown, 1000);
    updateCountdown();
  });
</script>

{% schema %}
{
  "name": "Premium Timer",
  "target": "section",
  "settings": [
    { "type": "text", "id": "end_date", "label": "End date (ISO)", "default": "2025-12-31T23:59:59Z" },
    { "type": "select", "id": "style", "label": "Style", "default": "standard", "options": [
      { "value": "standard", "label": "Standard" },
      { "value": "rectangle", "label": "Rectangle" },
      { "value": "circle", "label": "Circle" }
    ]},
    { "type": "checkbox", "id": "glow_effect", "label": "Glow effect", "default": true },

    { "type": "text", "id": "text", "label": "Label text", "default": "ðŸ”¥ Limited offer ends in" },
    { "type": "image_picker", "id": "background_image", "label": "Container background image" },
    { "type": "color", "id": "bg_color", "label": "Container bg color", "default": "#ffffff" },

    { "type": "checkbox", "id": "show_days", "label": "Show days", "default": true },
    { "type": "text", "id": "label_days", "label": "Days label", "default": "d" },
    { "type": "checkbox", "id": "show_hours", "label": "Show hours", "default": true },
    { "type": "text", "id": "label_hours", "label": "Hours label", "default": "h" },
    { "type": "checkbox", "id": "show_minutes", "label": "Show minutes", "default": true },
    { "type": "text", "id": "label_minutes", "label": "Minutes label", "default": "m" },
    { "type": "checkbox", "id": "show_seconds", "label": "Show seconds", "default": true },
    { "type": "text", "id": "label_seconds", "label": "Seconds label", "default": "s" },

    { "type": "image_picker", "id": "block_background_image", "label": "Blocks background image" },
    { "type": "color", "id": "timer_bg", "label": "Blocks bg color", "default": "#ffffff" },

    { "type": "text", "id": "border_size", "label": "Border size (e.g. 2px)", "default": "2px" },
    { "type": "color", "id": "border_color", "label": "Border color", "default": "#ff0000" },

    { "type": "range", "id": "font_size", "label": "Font size (px)", "min": 12, "max": 50, "step": 1, "default": 18 },
    { "type": "text", "id": "block_width", "label": "Block width (e.g. 70px)", "default": "70px" },
    { "type": "text", "id": "block_height", "label": "Block height (e.g. 70px)", "default": "70px" },

    { "type": "text", "id": "button_text", "label": "Button text", "default": "Shop now" },
    { "type": "url",  "id": "button_link", "label": "Button link" },
    { "type": "color", "id": "button_color", "label": "Button bg", "default": "#000000" },
    { "type": "color", "id": "button_text_color", "label": "Button text color", "default": "#ffffff" }
  ]
}
{% endschema %}
