{% comment %}
  Premium Popup (EN) — Section app
{% endcomment %}

<style>
  .popup-premium-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,.5);
    justify-content: center; align-items: center; z-index: 9999;
  }
  .popup-premium-overlay.visible { display: flex !important; }

  .popup-premium-content {
    padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;
    background-color: {{ section.settings.bg_color }}; color: {{ section.settings.text_color }};
    box-shadow: 0 10px 30px rgba(0,0,0,.2); position: relative; animation: fadeIn .4s ease;
    {% if section.settings.background_image != blank %}
      background-image: url("{{ section.settings.background_image | image_url: width: 1600 }}");
      background-size: cover; background-position: center;
    {% endif %}
  }
  .popup-premium-content.light { animation: glowEffect 2s ease-in-out infinite alternate; }
  .popup-premium-content.light-glow {
    {% if section.settings.background_image == blank %}
      background: radial-gradient(circle, {{ section.settings.bg_color }} 0%, transparent 100%);
    {% endif %}
    box-shadow: 0 0 20px {{ section.settings.bg_color }};
    animation: glowEffectStrong 1.6s ease-in-out infinite alternate;
  }
  @keyframes glowEffect { from{ box-shadow:0 0 10px {{ section.settings.bg_color }} } to{ box-shadow:0 0 30px {{ section.settings.bg_color }} } }
  @keyframes glowEffectStrong { from{ box-shadow:0 0 20px {{ section.settings.bg_color }} } to{ box-shadow:0 0 45px {{ section.settings.bg_color }} } }

  .popup-close {
    position:absolute; top:10px; right:15px; background:transparent; border:0;
    font-size: {{ section.settings.close_icon_size }}px; color: {{ section.settings.text_color }}; cursor: pointer;
  }

  .popup-button-container { display:flex; justify-content: {{ section.settings.button_position }}; align-items:center; margin-top: 15px; }
  .popup-button {
    display:inline-flex; align-items:center; background: {{ section.settings.button_color }};
    color: {{ section.settings.button_text_color }};
    padding: {{ section.settings.button_padding_vertical }}px {{ section.settings.button_padding_horizontal }}px;
    border-radius: {{ section.settings.button_border_radius }}px;
    border: {{ section.settings.button_border_size }}px solid {{ section.settings.button_border_color }};
    font-size: {{ section.settings.button_font_size }}px; font-weight: bold; text-decoration:none;
  }
  .popup-button-icon { width: {{ section.settings.button_icon_size }}px; height: {{ section.settings.button_icon_size }}px; margin-right: 8px; vertical-align: middle; }

  @keyframes fadeIn { from{opacity:0; transform:scale(.9)} to{opacity:1; transform:scale(1)} }
</style>

<div id="popup-{{ section.id }}" class="popup-premium-overlay">
  <div class="popup-premium-content{% if section.settings.style == 'light' %} light{% elsif section.settings.style == 'light-glow' %} light-glow{% endif %}">
    <button class="popup-close" aria-label="Close popup">×</button>

    <h2 style="
      font-size: {{ section.settings.title_font_size }}px;
      font-weight: {{ section.settings.title_font_weight }};
      color: {{ section.settings.title_color }};
      text-align: {{ section.settings.title_alignment }};
    ">
      {{ section.settings.title }}
    </h2>

    <p style="
      font-size: {{ section.settings.message_font_size }}px;
      text-align: {{ section.settings.message_alignment }};
      font-weight: {{ section.settings.message_font_weight }};
    ">
      {{ section.settings.message }}
    </p>

    {% if section.settings.button_text != blank %}
      <div class="popup-button-container">
        {% if section.settings.button_icon != blank %}
          {{ section.settings.button_icon
            | image_url: width: section.settings.button_icon_size, height: section.settings.button_icon_size
            | image_tag: class: 'popup-button-icon', alt: 'Button icon', width: section.settings.button_icon_size, height: section.settings.button_icon_size
          }}
        {% endif %}
        <a href="{{ section.settings.button_link }}" class="popup-button">{{ section.settings.button_text }}</a>
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const popup   = document.getElementById("popup-{{ section.id }}");
    const closeBtn= popup.querySelector('.popup-close');
    const delayMs = ({{ section.settings.delay | default: 4 }}) * 1000;

    if (popup.parentNode !== document.body) document.body.appendChild(popup);
    popup.classList.remove('visible');

    if (Shopify.designMode) {
      popup.classList.add('visible');
    } else {
      setTimeout(() => popup.classList.add('visible'), delayMs);
    }

    if (closeBtn) closeBtn.addEventListener('click', () => popup.classList.remove('visible'));
  });
</script>

{% schema %}
{
  "name": "Premium Popup",
  "target": "section",
  "settings": [
    { "type":"select","id":"style","label":"Popup style","default":"standard","options":[
      { "value":"standard","label":"Standard" },
      { "value":"light","label":"Light glow" },
      { "value":"light-glow","label":"Pro glow" }
    ]},

    { "type":"text","id":"title","label":"Title","default":"Welcome!" },
    { "type":"select","id":"title_alignment","label":"Title alignment","default":"center","options":[
      { "value":"left","label":"Left" }, { "value":"center","label":"Center" }, { "value":"right","label":"Right" }
    ]},
    { "type":"color","id":"title_color","label":"Title color","default":"#000000" },

    { "type":"textarea","id":"message","label":"Message","default":"Enjoy 10% OFF with code WELCOME10" },
    { "type":"select","id":"message_font_weight","label":"Message weight","default":"bold","options":[
      { "value":"normal","label":"Normal" }, { "value":"bold","label":"Bold" }
    ]},
    { "type":"select","id":"message_alignment","label":"Message alignment","default":"center","options":[
      { "value":"left","label":"Left" }, { "value":"center","label":"Center" }, { "value":"right","label":"Right" }
    ]},

    { "type":"color","id":"text_color","label":"Text color","default":"#000000" },
    { "type":"range","id":"title_font_size","label":"Title size (px)","min":14,"max":48,"step":1,"default":24 },
    { "type":"select","id":"title_font_weight","label":"Title weight","default":"bold","options":[
      { "value":"normal","label":"Normal" }, { "value":"bold","label":"Bold" }
    ]},
    { "type":"range","id":"message_font_size","label":"Message size (px)","min":12,"max":36,"step":1,"default":16 },

    { "type":"image_picker","id":"background_image","label":"Background image" },
    { "type":"color","id":"bg_color","label":"Background color","default":"#F9E010" },
    { "type":"range","id":"close_icon_size","label":"Close icon size (px)","min":12,"max":40,"step":1,"default":22 },
    { "type":"range","id":"delay","label":"Delay before show (sec)","min":0,"max":30,"step":1,"default":4 },

    { "type":"text","id":"button_text","label":"Button text","default":"Get it" },
    { "type":"url","id":"button_link","label":"Button link" },
    { "type":"select","id":"button_position","label":"Button position","default":"center","options":[
      { "value":"flex-start","label":"Left" }, { "value":"center","label":"Center" }, { "value":"flex-end","label":"Right" }
    ]},
    { "type":"range","id":"button_padding_vertical","label":"Button padding Y (px)","min":0,"max":30,"step":1,"default":10 },
    { "type":"range","id":"button_padding_horizontal","label":"Button padding X (px)","min":0,"max":50,"step":1,"default":20 },
    { "type":"range","id":"button_font_size","label":"Button font size (px)","min":12,"max":32,"step":1,"default":16 },
    { "type":"color","id":"button_color","label":"Button background","default":"#000000" },
    { "type":"color","id":"button_text_color","label":"Button text color","default":"#ffffff" },
    { "type":"image_picker","id":"button_icon","label":"Button icon (optional)" },
    { "type":"range","id":"button_icon_size","label":"Icon size (px)","min":12,"max":48,"step":1,"default":28 },
    { "type":"range","id":"button_border_radius","label":"Button radius (px)","min":0,"max":40,"step":1,"default":8 },
    { "type":"range","id":"button_border_size","label":"Button border (px)","min":0,"max":6,"step":1,"default":0 },
    { "type":"color","id":"button_border_color","label":"Button border color","default":"#000000" }
  ],
  "presets": [{ "name": "Premium Popup" }]
}
{% endschema %}
